<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TodoModel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HW9</a> &gt; <a href="index.source.html" class="el_package">model</a> &gt; <span class="el_source">TodoModel.java</span></div><h1>TodoModel.java</h1><pre class="source lang-java linenums">package model;

import com.opencsv.CSVReader;
import com.opencsv.CSVWriter;
import exception.InvalidIDException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Objects;

public class TodoModel {

<span class="fc" id="L18">  private List&lt;TodoItem&gt; todoList = new ArrayList&lt;&gt;();</span>
  private String path;

<span class="fc" id="L21">  public TodoModel(String csvFilePath) throws IOException, ParseException {</span>
<span class="fc" id="L22">    this.csvToModel(csvFilePath);</span>
<span class="fc" id="L23">  }</span>

  private void csvToModel(String csvFilePath) throws IOException, ParseException {
<span class="fc" id="L26">    this.path = csvFilePath;</span>
<span class="fc" id="L27">    CSVReader reader = new CSVReader(new FileReader(this.path), ',');</span>
<span class="fc" id="L28">    List&lt;String[]&gt; csvBody = reader.readAll();</span>
<span class="fc" id="L29">    reader.close();</span>
    // for each line, construct a todoItem object, and put it into todoList
<span class="fc bfc" id="L31" title="All 2 branches covered.">    for (int i = 1; i &lt; csvBody.size(); i++) {</span>
<span class="fc" id="L32">      String[] row = csvBody.get(i);</span>
      // deal with id
<span class="fc" id="L34">      Integer id = Integer.valueOf(row[0]);</span>
      // deal with text
<span class="fc" id="L36">      String text = row[1];</span>
      // deal with completed
<span class="fc" id="L38">      Boolean completed = row[2].equals(&quot;true&quot;);</span>
      // deal with due
<span class="fc bfc" id="L40" title="All 2 branches covered.">      Date due = row[3].equals(&quot;?&quot;) ? null : new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(row[3]);</span>
      // deal with priority
<span class="fc" id="L42">      Integer priority = Integer.valueOf(row[4]);</span>
      // deal with category
<span class="fc bfc" id="L44" title="All 2 branches covered.">      String category = row[5].equals(&quot;?&quot;) ? null : row[5];</span>
      // construct a todoItem object
<span class="fc" id="L46">      TodoItem item = new TodoItem(id, text, completed, due, priority, category);</span>
      // put into todoList
<span class="fc" id="L48">      this.todoList.add(item);</span>
    }
<span class="fc" id="L50">  }</span>

  public void addTodoItem(TodoItem item) throws IOException {
<span class="fc bfc" id="L53" title="All 2 branches covered.">    if (item == null) {</span>
<span class="fc" id="L54">      return;</span>
    }
<span class="fc" id="L56">    item.setId(this.todoList.size() + 1);</span>
<span class="fc" id="L57">    this.todoList.add(item);</span>
    // transform fields of todoItem to string
<span class="fc" id="L59">    String id = String.valueOf(item.getId());</span>
<span class="fc" id="L60">    String text = item.getText();</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">    String completed = item.getCompleted() ? &quot;true&quot; : &quot;false&quot;;</span>
    String due;
<span class="fc bfc" id="L63" title="All 2 branches covered.">    if (item.getDue() == null) {</span>
<span class="fc" id="L64">      due = &quot;?&quot;;</span>
    } else {
<span class="fc" id="L66">      SimpleDateFormat formatter = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="fc" id="L67">      due = formatter.format(item.getDue());</span>
    }
<span class="fc" id="L69">    String priority = String.valueOf(item.getPriority());</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">    String category = item.getCategory() == null ? &quot;?&quot; : item.getCategory();</span>
    // write item into csv file
<span class="fc" id="L72">    CSVWriter writer = new CSVWriter(new FileWriter(this.path, true), ',');</span>
<span class="fc" id="L73">    writer.writeNext(new String[]{id, text, completed, due, priority, category});</span>
<span class="fc" id="L74">    writer.flush();</span>
<span class="fc" id="L75">    writer.close();</span>
<span class="fc" id="L76">  }</span>

  public void completeTodos(List&lt;Integer&gt; ids) throws IOException, InvalidIDException {
<span class="fc" id="L79">    CSVReader reader = new CSVReader(new FileReader(this.path), ',');</span>
<span class="fc" id="L80">    List&lt;String[]&gt; csvBody = reader.readAll();</span>
<span class="fc" id="L81">    reader.close();</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">    for (int id : ids) {</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">      if (id &gt; this.todoList.size()) {</span>
<span class="fc" id="L84">        throw new InvalidIDException(&quot;Error: you attempt to complete a Todo that does not exist!&quot;);</span>
      }
      // update todoList
<span class="fc" id="L87">      this.todoList.get(id - 1).setCompleted(true);</span>
      // update the csv file
<span class="fc" id="L89">      csvBody.get(id)[2] = &quot;true&quot;;</span>
<span class="fc" id="L90">    }</span>
    // write the updated todoList to csv file
<span class="fc" id="L92">    CSVWriter writer = new CSVWriter(new FileWriter(this.path), ',');</span>
<span class="fc" id="L93">    writer.writeAll(csvBody);</span>
<span class="fc" id="L94">    writer.flush();</span>
<span class="fc" id="L95">    writer.close();</span>
<span class="fc" id="L96">  }</span>

  public List&lt;TodoItem&gt; getTodoList() {
<span class="fc" id="L99">    return todoList;</span>
  }

  @Override
  public boolean equals(Object o) {
<span class="fc bfc" id="L104" title="All 2 branches covered.">    if (this == o) {</span>
<span class="fc" id="L105">      return true;</span>
    }
<span class="fc bfc" id="L107" title="All 4 branches covered.">    if (o == null || getClass() != o.getClass()) {</span>
<span class="fc" id="L108">      return false;</span>
    }
<span class="fc" id="L110">    TodoModel todoModel = (TodoModel) o;</span>
<span class="fc" id="L111">    return Objects.equals(todoList, todoModel.todoList);</span>
  }

  @Override
  public int hashCode() {
<span class="fc" id="L116">    return Objects.hash(todoList);</span>
  }

  @Override
  public String toString() {
<span class="fc" id="L121">    return &quot;TodoModel{&quot; +</span>
        &quot;todoList=&quot; + todoList +
        '}';
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>