<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TodoModel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HW9</a> &gt; <a href="index.source.html" class="el_package">problem.model</a> &gt; <span class="el_source">TodoModel.java</span></div><h1>TodoModel.java</h1><pre class="source lang-java linenums">package problem.model;

import com.opencsv.CSVReader;
import com.opencsv.CSVWriter;
import problem.exception.InvalidIDException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Objects;

/**
 * Class todoModel stores the todoList and supports two functionality: add a new todo and complete
 * an existing todo
 */
public class TodoModel {

<span class="fc" id="L22">  private List&lt;TodoItem&gt; todoList = new ArrayList&lt;&gt;();</span>
  private String path;

  /**
   * Constructor fot TodoModel
   *
   * @param csvFile - csv file path
   * @throws IOException    if an I/O exception has occurred
   * @throws ParseException if an error has been reached unexpectedly while parsing
   */
<span class="fc" id="L32">  public TodoModel(String csvFile) throws IOException, ParseException {</span>
<span class="fc" id="L33">    this.csvToModel(csvFile);</span>
<span class="fc" id="L34">  }</span>

  /**
   * Load data from csv file into ArrayList
   *
   * @param csvFile - csv file path
   * @throws IOException    if an I/O exception has occurred
   * @throws ParseException if an error has been reached unexpectedly while parsing
   */
  private void csvToModel(String csvFile) throws IOException, ParseException {
<span class="fc" id="L44">    this.path = csvFile;</span>
<span class="fc" id="L45">    CSVReader reader = new CSVReader(new FileReader(this.path), ',');</span>
<span class="fc" id="L46">    List&lt;String[]&gt; csvBody = reader.readAll();</span>
<span class="fc" id="L47">    reader.close();</span>
    // for each line, construct a todoItem object, and put it into todoList
<span class="fc bfc" id="L49" title="All 2 branches covered.">    for (int i = 1; i &lt; csvBody.size(); i++) {</span>
<span class="fc" id="L50">      String[] row = csvBody.get(i);</span>
      // deal with id
<span class="fc" id="L52">      Integer id = Integer.valueOf(row[0]);</span>
      // deal with text
<span class="fc" id="L54">      String text = row[1];</span>
      // deal with completed
<span class="fc" id="L56">      Boolean completed = row[2].equals(&quot;true&quot;);</span>
      // deal with due
<span class="fc bfc" id="L58" title="All 2 branches covered.">      Date due = row[3].equals(&quot;?&quot;) ? null : new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(row[3]);</span>
      // deal with priority
<span class="fc" id="L60">      Integer priority = Integer.valueOf(row[4]);</span>
      // deal with category
<span class="fc bfc" id="L62" title="All 2 branches covered.">      String category = row[5].equals(&quot;?&quot;) ? null : row[5];</span>
      // construct a todoItem object
<span class="fc" id="L64">      TodoItem item = new TodoItem(id, text, completed, due, priority, category);</span>
      // put into todoList
<span class="fc" id="L66">      this.todoList.add(item);</span>
    }
<span class="fc" id="L68">  }</span>

  /**
   * Add a todoItem to the todoList, and when a new todo is added, the csv file will be updated
   *
   * @param item - item to be added
   * @throws IOException if an I/O exception has occurred
   */
  public void addTodoItem(TodoItem item) throws IOException {
<span class="fc bfc" id="L77" title="All 2 branches covered.">    if (item == null) {</span>
<span class="fc" id="L78">      return;</span>
    }
<span class="fc" id="L80">    item.setId(this.todoList.size() + 1);</span>
<span class="fc" id="L81">    this.todoList.add(item);</span>
    // transform fields of todoItem to string
<span class="fc" id="L83">    String id = String.valueOf(item.getId());</span>
<span class="fc" id="L84">    String text = item.getText();</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">    String completed = item.getCompleted() ? &quot;true&quot; : &quot;false&quot;;</span>
    String due;
<span class="fc bfc" id="L87" title="All 2 branches covered.">    if (item.getDue() == null) {</span>
<span class="fc" id="L88">      due = &quot;?&quot;;</span>
    } else {
<span class="fc" id="L90">      SimpleDateFormat formatter = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="fc" id="L91">      due = formatter.format(item.getDue());</span>
    }
<span class="fc" id="L93">    String priority = String.valueOf(item.getPriority());</span>
<span class="fc bfc" id="L94" title="All 2 branches covered.">    String category = item.getCategory() == null ? &quot;?&quot; : item.getCategory();</span>
    // write item into csv file
<span class="fc" id="L96">    CSVWriter writer = new CSVWriter(new FileWriter(this.path, true), ',');</span>
<span class="fc" id="L97">    writer.writeNext(new String[]{id, text, completed, due, priority, category});</span>
<span class="fc" id="L98">    writer.flush();</span>
<span class="fc" id="L99">    writer.close();</span>
<span class="fc" id="L100">  }</span>

  /**
   * Set the completed status of an existing todo to true, when the status is changed, the csv file
   * will be updated
   *
   * @param ids - list of completed todos' id
   * @throws IOException        if an I/O exception has occurred
   * @throws InvalidIDException if the provided id does not exist
   */
  public void completeTodos(List&lt;Integer&gt; ids) throws IOException, InvalidIDException {
<span class="fc" id="L111">    CSVReader reader = new CSVReader(new FileReader(this.path), ',');</span>
<span class="fc" id="L112">    List&lt;String[]&gt; csvBody = reader.readAll();</span>
<span class="fc" id="L113">    reader.close();</span>
<span class="fc bfc" id="L114" title="All 2 branches covered.">    for (int id : ids) {</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">      if (id &gt; this.todoList.size()) {</span>
<span class="fc" id="L116">        throw new InvalidIDException(&quot;Error: you attempt to complete a Todo that does not exist!&quot;);</span>
      }
      // update todoList
<span class="fc" id="L119">      this.todoList.get(id - 1).setCompleted(true);</span>
      // update the csv file
<span class="fc" id="L121">      csvBody.get(id)[2] = &quot;true&quot;;</span>
<span class="fc" id="L122">    }</span>
    // write the updated todoList to csv file
<span class="fc" id="L124">    CSVWriter writer = new CSVWriter(new FileWriter(this.path), ',');</span>
<span class="fc" id="L125">    writer.writeAll(csvBody);</span>
<span class="fc" id="L126">    writer.flush();</span>
<span class="fc" id="L127">    writer.close();</span>
<span class="fc" id="L128">  }</span>

  /**
   * @return the current todoList
   */
  public List&lt;TodoItem&gt; getTodoList() {
<span class="fc" id="L134">    return todoList;</span>
  }

  /**
   * Indicates whether some other object is &quot;equal to&quot; this one.
   *
   * @param o - the reference object with which to compare.
   * @return true if this object is the same as the obj argument; false otherwise.
   */
  @Override
  public boolean equals(Object o) {
<span class="fc bfc" id="L145" title="All 2 branches covered.">    if (this == o) {</span>
<span class="fc" id="L146">      return true;</span>
    }
<span class="fc bfc" id="L148" title="All 4 branches covered.">    if (o == null || getClass() != o.getClass()) {</span>
<span class="fc" id="L149">      return false;</span>
    }
<span class="fc" id="L151">    TodoModel todoModel = (TodoModel) o;</span>
<span class="fc" id="L152">    return Objects.equals(todoList, todoModel.todoList);</span>
  }

  /**
   * Returns a hash code value for the object.
   *
   * @return a hash code value for this object.
   */
  @Override
  public int hashCode() {
<span class="fc" id="L162">    return Objects.hash(todoList);</span>
  }

  /**
   * Returns a string representation of the object.
   *
   * @return a string representation of the object.
   */
  @Override
  public String toString() {
<span class="fc" id="L172">    return &quot;TodoModel{&quot; +</span>
        &quot;todoList=&quot; + todoList +
        '}';
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>